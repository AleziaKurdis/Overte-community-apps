<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<script type="text/javascript" src="../applications/metadata.js"></script>
		<script>
			//Parameters
			function findGetParameter(parameterName) {
				var result = null,
					tmp = [];
				var items = location.search.substr(1).split("&");
				for (var index = 0; index < items.length; index++) {
					tmp = items[index].split("=");
					if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
				}
				return result;
			}

			
			var offset = findGetParameter("offset");
			if(offset === null){offset = 0;}
			offset = parseInt(offset);
			
			var perpage = findGetParameter("perpage");
			if(perpage === null){perpage = 15;}
			perpage = parseInt(perpage);
			
			var search = findGetParameter("search");
			if(search === null){search = "";}			
	

			
			//Search
			function doSearch(keyword){
				location.href = "more.html?offset=0&search=" + encodeURI(keyword);
			}

			function clearSearch(){
				location.href = "more.html?offset=0";
			}
			
			
			
			//Paths
			var currentPath = window.location.protocol + "//" + window.location.host + "/" + window.location.pathname;
			var rootPath = currentPath.replace("more/more.html", "applications/");
			
			//Running scripts 
			var currentlyRunningScripts;
			
			EventBridge.scriptEventReceived.connect(function(message){
				currentlyRunningScripts = message; 
            });

			function CheckRunning(scriptName){
			
				return false;
			}
			

		</script>
		<style>
		
			body {
				background: #73758c;
				font-family: Arial, Helvetica, sans-serif;
				font-size: 12px;
				color: #FFFFFF;
				font-weight: 600;
				text-decoration: none;
				font-style: normal;
				font-variant: normal;
				text-transform: none;
			}
		
			h1 {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 28px;
				color: #ffffff;
				font-weight: 800;
				text-decoration: none;
				font-style: normal;
				font-variant: normal;
				text-transform: none;
				text-shadow: 3px 3px 3px rgba(63,64,76,1);
			}

			font.appname {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 18px;
				color: #CFB538;
				font-weight: 800;
				text-decoration: none;
				font-style: normal;
				font-variant: normal;
				text-transform: none;
			}

			font.appdesc {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 14px;
				color: #ffffff;
				font-weight: 500;
				text-decoration: none;
				font-style: normal;
				font-variant: normal;
				text-transform: none;
			}

			font.caption {
				font-family: Arial, Helvetica, sans-serif;
				font-size: 12px;
				color: #ffffff;
				font-weight: 600;
				text-decoration: none;
				font-style: normal;
				font-variant: normal;
				text-transform: none;
			}
			
			div.iconContainer{
				border-radius: 15px;
				background: #000000;
				padding: 5px;
				width: 70px;
				height: 70px;
				text-align: center;
			}
			
			table.item {
				background: #3E415E;
			}
			
			td {
				vertical-align: top;
				padding: 5px;
			}

			button.install {
				background-color: #008CBA;
				font-size: 16px;
				color: #ffffff;
				font-weight: 600;
				border-radius: 6px;
				border: 2px solid #008CBA;
				transition-duration: 0.3s;
			}
			
			button.install:hover {
			  background-color: #10afe3; 
			  border: 2px solid #10afe3;
			}

			button.uninstall {
				background-color: #b34700;
				font-size: 16px;
				color: #ffffff;
				font-weight: 600;
				border-radius: 6px;
				border: 2px solid #b34700;
				transition-duration: 0.3s;
			}
			
			button.uninstall:hover {
			  background-color: #e34c22; 
			  border: 2px solid #e34c22;
			}

			div.searchbox {
				border-radius: 6px;
				background: #ffffff;
				padding: 4px;
				border: 0px;
				vertical-align: middle;
			}
			
			input.searchtextbox{
				font-family: Arial, Helvetica, sans-serif;
				font-size: 14px;
				color: #000000;
				font-weight: 400;
				text-decoration: none;
				border: 0px;
			}
			
		</style>
	</head>
	<body><form name = "searchbar">
		<h1>Add more functionalities...</h1>
		
		<table style = "width:100%;">
			<tr >
				<td style = "vertical-align: middle; text-align: left;">
					<table>
						<tr>
							<td style = "vertical-align: middle; text-align: left;">
								<div class = "searchbox">
									<input class = "searchtextbox" name = "searchtextbox" size = "25" maxlength="32"> <a href="#" onclick='clearSearch();'><img src="del-x-16.png"></a>
								</div>
							</td>
							<td style = "vertical-align: middle; text-align: center;">
								<a href = "#" onclick = 'doSearch(document.searchbar.searchtextbox.value);'>S</a>
							</td>
						</tr>
					</table>
				</td>
				<td style = "vertical-align: middle; text-align: right;">
					<div id = 'pager'></div>
				</td>				
			</tr>
		</table>
		</form><br>
		
		
		<script>

			document.searchbar.searchtextbox.value = search;
			

			function DisplayApp(item) {
				document.write("<a name = '" + window.btoa(item.name) + "'><table class='item'><tr>");
				document.write("<td><div class='iconContainer'><img src='" + rootPath + item.icon + "' style='width:50px;'><br><font class = 'caption'>" + item.caption + "</font></div></td>");
				var btn = "";
				var absoluteJsFile = rootPath + item.jsfile;
				if(CheckRunning(absoluteJsFile) != false){
					//Means already running
					btn = "<button class='uninstall'>Uninstall</button>";
				}else{
					//Means not already installed
					btn = "<button class='install'>Install</button>";
				}
				
				
				document.write("<td><font class='appname'>" + item.name + "<br></font><font class = 'appdesc'>" + item.description + "<br></font><div align='right'>" + btn + "</div></td>");
				document.write("</tr></table><br><br>");				
			}
		

			var counterDir = -1;
			var counterDisp = 0;
			var index = 0;
			var lowItem = "";
			var needNext = false;
			
			for (index = 0; index < metadata.applications.length; index++){
				lowItem = metadata.applications[index].name.toLowerCase();
				if (lowItem.indexOf(search.toLowerCase()) != -1){ 
					counterDir = counterDir + 1;
					if ((counterDir >= offset) && (counterDir < (offset + perpage))){
						DisplayApp(metadata.applications[index]);
						counterDisp = counterDisp + 1;
					}
					if (counterDir >= (offset + perpage)){
						needNext = true;
						break;
					}
				}
			}
			
			//pager
			
			function pagetoPrevious(){
				offset = offset - perpage;
				if (offset < 0){
					offset = 0;
				}
				location.href = "more.html?offset=" + offset + "&perpage=" + perpage + "&search=" + encodeURI(search);			
			}
			
			function pagetoNext(){
				offset = offset + perpage;
				location.href = "more.html?offset=" + offset + "&perpage=" + perpage + "&search=" + encodeURI(search);
			}
			
			var pagerPrevious = "<a href='#' onclick='pagetoPrevious();'>&lt;</a>";
			if (offset <= 0){
				pagerPrevious = "";
			}
			
			var pagerNext = "<a href='#' onclick='pagetoNext();'>&gt;</a>";
			if (needNext == false){
				pagerNext = "";
			}			
			
			var countA = offset + 1;
			
			var countB = offset + counterDisp;
			
			
			document.getElementById( "pager" ).innerHTML = pagerPrevious + "<font class='pager'>&nbsp;&nbsp;" + countA + " - " + countB  + "&nbsp;&nbsp;</font>" + pagerNext; //offset = 0 will do for < btn | offset + counterDir = perpage then >


		</script>

	</body>
</html>